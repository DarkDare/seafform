{% extends "base.html" %}
{% load bootstrap %}

{% block title %}{{ seafform.title }}{% endblock %}

{% block headers %}
<style>
    .required:after {
        font-family: "Glyphicons Halflings";
        font-style: normal;
        font-weight: 400;
        line-height: 1;
        font-size: 70%;
        color: #2AABD2;
        content: " î…¥"; //glyphicon glyphicon-record
    }
</style>
{% endblock %}

{% block body %}

<div class="container-fluid" role="main">

    <div class="jumbotron clearfix">
    
        <img 
            src="/static/seafform/images/telephone-man-150px.png" 
            class="img-responsive pull-left hidden-xs"
            alt="Telephoning woman picture"
            style="margin:1em;"
            aria-hidden="true"
        >
        
        <h1>{{ seafform.title }}</h1>
        
        {{ seafform.description|linebreaks }}
        
    </div>
    
    <div class="table-responsive">
    <form action="{{ modelform.get_absolute_url }}" method="post">
    {% csrf_token %}
    <table class="table table-striped">
        <tr>
        {% for field in seafform.fields %}
            <th>{{ field.label }}</th>
        {% endfor %}
            <th>Action</th> 
        </tr>
        
        <tbody>
        {% for row in seafform.data %}
            <tr 
                {% if forloop.counter0 == justaddedrow %}class="success"{% endif %} 
                id="row-{{ forloop.counter0 }}"
            >
                {% for value in row %}
                    {% if value == True %}
                        <td>
                            <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                            <span class="sr-only">Ok</span>
                        </td>
                    {% elif not value %}
                        <td></td>
                    {% else %}
                        <td>{{ value|linebreaks }}</td>
                    {% endif %}
                {% endfor %}
                <td>
                    <button class="btn btn-default row-edit" 
                            type="button"
                            onclick="rowedit({{ forloop.counter0}})">
                        <span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>        
                    </button>
                </td>
            </tr>
            {% if seafform.edit %}
                <tr id="row-{{ forloop.counter0}}-edit" class="hidden success">
                    {% for value in row %}
                        {% if forloop.first %}
                            <td>Chargement...</td>
                        {% else %}
                            <td></td>
                        {% endif %}
                    {% endfor %}
                    <td>
                    <button class="btn btn-default invisible" type="button"
                        aria-hidden="true">spacer</button>
                    </td>
                </tr>
            {% endif %}
        {% endfor %}
        
        
        <tr id="newrow-edit">
            {% for field in djform.hidden_fields %}
                {{ field }}
            {% endfor %}
            {% for field in djform.visible_fields %}
                <td>
                    {{ field|bootstrap }}
                </td>
            {% endfor %}
            <td>
                <button class="btn btn-success" type="submit" aria-label="Valider">
                    <span class="glyphicon glyphicon-ok" aria-hidden="true"></span>
                </button>
            </td>
        </tr>
        </tbody>
    </table>
    </form>
    </div>
    
    <p aria-hidden="true" class="text-right">
        <span class="required"></span> : <em>champs obligatoires.</em>
    </p>
    
    <div class="row"><div class="col-md-6 col-md-offset-3">

    </div></div>
</div>

{% endblock %}

{% block scripts %}
    <script type="text/javascript">
        function rowedit(rowid) {
            // hide the rowid line
            $("#row-" + rowid).addClass("hidden");
            // hide and disable the newrow form
            $("#newrow-edit input").attr('disabled', 'disabled');
            $("#newrow-edit").addClass("invisible");
            // show the rowidid-edit line
            $("#row-" + rowid + "-edit").removeClass("hidden");
            $("#row-" + rowid + "-edit").load(
                "{{ modelform.get_absolute_url }}" + rowid + "/"
            );
        };
        function rowcancel(rowid) {
            // remove the rowid-edit line
            $("#row-" + rowid + "-edit").html("<td>Chargement...</td>");
            $("#row-" + rowid + "-edit").addClass("hidden");
            // show the rowid line
            $("#row-" + rowid).removeClass("hidden");
            // show and enable the newrow form
            $("#newrow-edit input").removeAttr('disabled');
            $("#newrow-edit").removeClass("invisible"); 
        }
    </script>
{% endblock %}
